<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·å·æ‰‘å…‹ - ä¸“ä¸šç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1E1E1E 0%, #0A1929 50%, #1a1a2e 100%);
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .top-bar {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #D4AF37;
            z-index: 100;
        }

        .top-bar .logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #D4AF37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .top-bar .game-info {
            display: flex;
            gap: 30px;
            font-size: 0.95em;
        }

        .top-bar .game-info span {
            color: #fff;
        }

        .top-bar .game-info span strong {
            color: #D4AF37;
        }

        /* æ¸¸æˆå¤§å… */
        .lobby-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(10, 25, 41, 0.95) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .lobby-content {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #D4AF37;
            border-radius: 20px;
            padding: 50px 60px;
            text-align: center;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
        }

        .lobby-content h1 {
            font-size: 2.8em;
            color: #D4AF37;
            margin-bottom: 40px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .lobby-input {
            width: 300px;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid rgba(212, 175, 55, 0.5);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            margin: 10px 0;
            outline: none;
            transition: all 0.3s;
        }

        .lobby-input:focus {
            border-color: #D4AF37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .lobby-btn {
            width: 300px;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 100%);
            color: #1a1a2e;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .lobby-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        /* æ¨¡å¼é€‰æ‹©æŒ‰é’® */
        .mode-selection {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
        }

        .mode-btn {
            width: 200px;
            padding: 30px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border: 2px solid rgba(212, 175, 55, 0.5);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.6);
            color: #D4AF37;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: #D4AF37;
            transform: scale(1.05);
        }

        .mode-btn .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .mode-btn .title {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .mode-btn .desc {
            font-size: 0.8em;
            color: #999;
        }

        .connection-status {
            margin-top: 20px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .connection-status.connected {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        .connection-status.disconnected {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            flex: 1;
            display: none;
            position: relative;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .game-area.active {
            display: flex;
        }

        /* ç‰Œæ¡Œ */
        .poker-table {
            position: relative;
            width: 700px;
            height: 700px;
            margin: 20px auto;
        }

        .table-outer {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #8B4513 0%, #654321 50%, #4a2c17 100%);
            border-radius: 50%;
            box-shadow:
                0 0 0 15px #D4AF37,
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(0, 0, 0, 0.3);
        }

        .table-inner {
            position: absolute;
            top: 30px;
            left: 30px;
            width: calc(100% - 60px);
            height: calc(100% - 60px);
            background: #D4B896;
            border-radius: 50%;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .table-logo {
            font-size: 1.5em;
            color: #8B4513;
            font-weight: bold;
            margin-bottom: 10px;
            opacity: 0.6;
        }

        /* å…¬å…±ç‰ŒåŒºåŸŸ */
        .community-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .pot-display {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #D4AF37;
            border-radius: 25px;
            padding: 10px 30px;
            font-size: 1.3em;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pot-display .label {
            color: #D4AF37;
        }

        .pot-display .amount {
            font-weight: bold;
            font-size: 1.2em;
        }

        .community-cards {
            display: flex;
            gap: 10px;
        }

        /* æ‰‘å…‹ç‰Œ */
        .card {
            width: 60px;
            height: 84px;
            background: linear-gradient(145deg, #fff 0%, #f5f5f5 100%);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            transition: all 0.3s;
        }

        .card.red {
            color: #c0392b;
        }

        .card.black {
            color: #2c3e50;
        }

        .card-rank {
            font-size: 18px;
            font-weight: bold;
        }

        .card-suit {
            font-size: 26px;
        }

        .card-back {
            background: linear-gradient(135deg, #8B0000 0%, #c0392b 50%, #8B0000 100%);
            background-size: 8px 8px;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 100%);
            border-radius: 50%;
            opacity: 0.8;
        }

        /* ç¿»ç‰ŒåŠ¨ç”» */
        @keyframes flipCard {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        .card.flipping {
            animation: flipCard 0.5s ease-in-out;
        }

        /* ç©å®¶åº§ä½ */
        .player-seats {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .player-seat {
            position: absolute;
            width: 160px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .player-seat.active {
            border-color: #D4AF37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.6); }
            50% { box-shadow: 0 0 50px rgba(212, 175, 55, 0.9); }
        }

        .player-seat.folded {
            opacity: 0.4;
        }

        .player-seat.winner {
            border-color: #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
        }

        .seat-number {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #333;
            color: #fff;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .player-details {
            flex: 1;
        }

        .player-name {
            font-size: 0.9em;
            font-weight: bold;
            color: #fff;
        }

        .player-chips {
            font-size: 0.8em;
            color: #D4AF37;
        }

        .player-status {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .status-badge.dealer {
            background: #D4AF37;
            color: #1a1a2e;
        }

        .status-badge.small-blind {
            background: #3498db;
            color: #fff;
        }

        .status-badge.big-blind {
            background: #e74c3c;
            color: #fff;
        }

        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            min-height: 45px;
        }

        .player-cards .card {
            width: 40px;
            height: 56px;
            font-size: 14px;
        }

        .player-bet {
            text-align: center;
            color: #e74c3c;
            font-size: 0.85em;
            font-weight: bold;
        }

        /* åº•éƒ¨æ“ä½œåŒº */
        .controls-area {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            border-top: 2px solid #D4AF37;
            padding: 15px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 100;
        }

        .controls-area .btn {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 100px;
        }

        .btn-fold {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .btn-call {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-raise {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .btn-allin {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .raise-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .raise-slider input {
            width: 150px;
        }

        .raise-slider span {
            color: #D4AF37;
            font-weight: bold;
            min-width: 60px;
        }

        /* æ¶ˆæ¯æ˜¾ç¤º */
        .message-bar {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 10px;
            padding: 10px 30px;
            font-size: 1em;
            color: #fff;
            z-index: 100;
            max-width: 500px;
            text-align: center;
        }

        .message-bar .highlight {
            color: #D4AF37;
            font-weight: bold;
        }

        /* ç­‰å¾…æˆ¿é—´ */
        .waiting-room {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 500;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .waiting-room.active {
            display: flex;
        }

        .waiting-room h2 {
            color: #D4AF37;
            font-size: 2em;
            margin-bottom: 30px;
        }

        .room-info {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #D4AF37;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .room-info p {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .room-info strong {
            color: #D4AF37;
        }

        .waiting-players {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            max-width: 600px;
        }

        .waiting-player {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px 20px;
            text-align: center;
        }

        .waiting-player .name {
            color: #D4AF37;
            font-weight: bold;
        }

        .start-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 100%);
            color: #1a1a2e;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: scale(1.05);
        }

        .exit-btn {
            position: fixed;
            top: 70px;
            right: 30px;
            padding: 10px 20px;
            background: #e74c3c;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
        }

        .exit-btn:hover {
            background: #c0392b;
        }

        /* æ‰‹ç‰Œé«˜äº® */
        @keyframes cardGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
            50% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }

        .card.winner-card {
            animation: cardGlow 1s infinite;
        }

        /* ç­¹ç é£å…¥åŠ¨ç”» */
        @keyframes chipFly {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        .chip-flying {
            animation: chipFly 0.5s ease-out;
        }

        .hidden {
            display: none !important;
        }

        /* æ–°æ¸¸æˆæŒ‰é’® */
        .new-game-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #D4AF37;
            border-radius: 20px;
            padding: 40px 60px;
            text-align: center;
            z-index: 2000;
            display: none;
        }

        .new-game-panel.active {
            display: block;
        }

        .new-game-panel h2 {
            color: #D4AF37;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .new-game-panel p {
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .new-game-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 100%);
            color: #1a1a2e;
            cursor: pointer;
            margin: 10px;
        }

        .new-game-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="top-bar">
            <div class="logo">â™  å¾·å·æ‰‘å…‹</div>
            <div class="game-info">
                <span id="mode-display">æ¨¡å¼: -</span>
                <span>ç›²æ³¨: <strong id="blind-info">10/20</strong></span>
                <span>å±€æ•°: <strong id="round-info">1</strong></span>
            </div>
            <div class="connection-status hidden" id="connection-status">æ£€æŸ¥ä¸­...</div>
        </div>

        <!-- æ¸¸æˆå¤§å… -->
        <div class="lobby-screen" id="lobby-screen">
            <div class="lobby-content">
                <h1>â™  å¾·å·æ‰‘å…‹ â™ </h1>

                <input type="text" id="player-name" class="lobby-input" placeholder="è¾“å…¥ä½ çš„æ˜µç§°" maxlength="20">

                <div style="margin-top: 30px;">
                    <p style="color: #D4AF37; margin-bottom: 15px; font-size: 1.2em;">é€‰æ‹©æ¸¸æˆæ¨¡å¼</p>
                    <div class="mode-selection">
                        <button class="mode-btn" onclick="selectMode('ai')">
                            <div class="icon">ğŸ¤–</div>
                            <div class="title">äººæœºå¯¹æˆ˜</div>
                            <div class="desc">ä¸AIç”µè„‘å¯¹æˆ˜</div>
                        </button>
                        <button class="mode-btn" onclick="selectMode('multiplayer')">
                            <div class="icon">ğŸ‘¥</div>
                            <div class="title">å¤šäººè”æœº</div>
                            <div class="desc">ä¸æœ‹å‹ä¸€èµ·ç©</div>
                        </button>
                    </div>
                </div>

                <!-- å¤šäººæ¨¡å¼é€‰é¡¹ -->
                <div id="multiplayer-options" class="hidden" style="margin-top: 30px;">
                    <div style="border-top: 1px solid rgba(212, 175, 55, 0.3); padding-top: 30px;">
                        <button class="lobby-btn" onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
                        <div style="margin-top: 20px;">
                            <p style="color: #999; margin-bottom: 15px;">æˆ–åŠ å…¥ç°æœ‰æˆ¿é—´</p>
                            <input type="text" id="room-id-input" class="lobby-input" placeholder="è¾“å…¥æˆ¿é—´ID" maxlength="10">
                            <button class="lobby-btn" onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
                        </div>
                    </div>
                </div>

                <div class="connection-status hidden" id="lobby-status">åç«¯çŠ¶æ€: æ£€æŸ¥ä¸­...</div>
            </div>
        </div>

        <!-- ç­‰å¾…æˆ¿é—´ -->
        <div class="waiting-room" id="waiting-room">
            <h2>ç­‰å¾…ç©å®¶åŠ å…¥...</h2>
            <div class="room-info">
                <p>æˆ¿é—´ID: <strong id="display-room-id">-</strong></p>
                <p>ä½ çš„ID: <strong id="display-player-id">-</strong></p>
                <p>åˆ†äº«æˆ¿é—´IDç»™æœ‹å‹å³å¯åŠ å…¥</p>
            </div>
            <div class="waiting-players" id="waiting-players-list">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button class="start-btn" onclick="startGame()" id="start-game-btn" style="display: none;">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <!-- æ¸¸æˆç»“æŸé¢æ¿ -->
        <div class="new-game-panel" id="game-over-panel">
            <h2 id="game-over-title">æ¸¸æˆç»“æŸ</h2>
            <p id="game-over-message"></p>
            <button class="new-game-btn" onclick="startNewGame()">å†æ¥ä¸€å±€</button>
            <button class="new-game-btn" onclick="backToLobby()">è¿”å›å¤§å…</button>
        </div>

        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area" id="game-area">
            <button class="exit-btn" onclick="exitGame()">é€€å‡ºæ¸¸æˆ</button>

            <div class="message-bar" id="message">ç­‰å¾…æ¸¸æˆå¼€å§‹...</div>

            <div class="poker-table">
                <div class="table-outer"></div>
                <div class="table-inner">
                    <div class="table-logo">Texas Hold'em</div>
                </div>

                <div class="community-area">
                    <div class="pot-display">
                        <span class="label">åº•æ± :</span>
                        <span class="amount" id="pot">0</span>
                    </div>
                    <div class="community-cards" id="community-cards">
                        <div class="card card-back"></div>
                        <div class="card card-back"></div>
                        <div class="card card-back"></div>
                        <div class="card card-back"></div>
                        <div class="card card-back"></div>
                    </div>
                </div>

                <div class="player-seats" id="player-seats">
                    <!-- åŠ¨æ€ç”Ÿæˆåº§ä½ -->
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨æ“ä½œåŒº -->
        <div class="controls-area" id="controls-area" style="display: none;">
            <button class="btn btn-fold" onclick="playerAction('fold')" id="btn-fold">å¼ƒç‰Œ</button>
            <button class="btn btn-check" onclick="playerAction('check')" id="btn-check">è¿‡ç‰Œ</button>
            <button class="btn btn-call" onclick="playerAction('call')" id="btn-call">è·Ÿæ³¨</button>
            <button class="btn btn-raise" onclick="playerAction('raise')" id="btn-raise">åŠ æ³¨</button>
            <button class="btn btn-allin" onclick="playerAction('allin')" id="btn-allin">å…¨æŠ¼</button>
        </div>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const API_BASE = 'https://think-conversion-dan-numerical.trycloudflare.com';

        // æ¸¸æˆæ¨¡å¼
        let gameMode = null; // 'ai' æˆ– 'multiplayer'

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            roomId: null,
            playerId: null,
            playerName: '',
            isHost: false,
            players: [],
            ws: null,
            pot: 0,
            communityCards: [],
            currentPlayerIndex: 0,
            deck: [],
            phase: 'idle', // idle, preflop, flop, turn, river, showdown
            currentBet: 0,
            dealerIndex: 0,
            smallBlind: 10,
            bigBlind: 20,
            roundNumber: 1
        };

        // AI ç©å®¶åç§°
        const AI_NAMES = ['è€ç‹', 'å°æ', 'é˜¿å¼º', 'ç¾å¥³', 'é«˜æ‰‹', 'åœŸè±ª', 'èŒæ–°', 'å¤§å¸ˆ'];

        // ç‰Œå€¼æ˜ å°„
        const RANK_VALUES = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14 };

        // åº§ä½ä½ç½®é…ç½® (2-6äººåº§)
        const seatPositions = [
            { x: 50, y: 80 },   // ä½ç½® 1 (åº•éƒ¨ - ç©å®¶)
            { x: 75, y: 60 },   // ä½ç½® 2 (å³ä¸‹)
            { x: 85, y: 35 },   // ä½ç½® 3 (å³)
            { x: 75, y: 10 },   // ä½ç½® 4 (å³ä¸Š)
            { x: 25, y: 10 },   // ä½ç½® 5 (å·¦ä¸Š)
            { x: 15, y: 35 }    // ä½ç½® 6 (å·¦)
        ];

        // ==================== æ¨¡å¼é€‰æ‹© ====================
        function selectMode(mode) {
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                showMessage('è¯·è¾“å…¥æ˜µç§°');
                return;
            }

            gameMode = mode;
            gameState.playerName = playerName;

            if (mode === 'ai') {
                // äººæœºæ¨¡å¼ - ç›´æ¥å¼€å§‹æ¸¸æˆ
                startAIGame();
            } else {
                // å¤šäººæ¨¡å¼ - æ˜¾ç¤ºæˆ¿é—´é€‰é¡¹
                document.getElementById('multiplayer-options').classList.remove('hidden');
                document.getElementById('connection-status').classList.remove('hidden');
                document.getElementById('lobby-status').classList.remove('hidden');
                checkBackend();
            }
        }

        // ==================== äººæœºå¯¹æˆ˜ ====================
        function startAIGame() {
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('game-area').classList.add('active');
            document.getElementById('controls-area').style.display = 'flex';
            document.getElementById('mode-display').textContent = 'æ¨¡å¼: ğŸ¤– äººæœºå¯¹æˆ˜';

            // åˆ›å»ºç©å®¶å’ŒAI
            const playerCount = Math.floor(Math.random() * 3) + 3; // 3-5ä¸ªAI
            gameState.players = [{
                id: 'player',
                name: gameState.playerName,
                chips: 1000,
                cards: [],
                folded: false,
                isAI: false
            }];

            for (let i = 0; i < playerCount; i++) {
                gameState.players.push({
                    id: `ai-${i}`,
                    name: AI_NAMES[i],
                    chips: 1000,
                    cards: [],
                    folded: false,
                    isAI: true
                });
            }

            initGame();
        }

        // ==================== å¤šäººè”æœº ====================
        async function apiRequest(method, url, data = null) {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) options.body = JSON.stringify(data);

            const response = await fetch(`${API_BASE}${url}`, options);
            const result = await response.json();
            if (!response.ok) throw new Error(result.detail || 'è¯·æ±‚å¤±è´¥');
            return result;
        }

        function connectWebSocket(roomId, playerId) {
            const ws = new WebSocket(`wss://think-conversion-dan-numerical.trycloudflare.com/ws/${roomId}/${playerId}`);

            ws.onopen = () => {
                console.log('WebSocket connected');
                updateConnectionStatus(true);
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                handleWebSocketMessage(message);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket closed');
                updateConnectionStatus(false);
            };

            return ws;
        }

        function handleWebSocketMessage(message) {
            switch (message.type) {
                case 'connected':
                    showMessage(message.message);
                    break;
                case 'player_joined':
                    gameState.players.push(message.player);
                    updateWaitingPlayers();
                    showMessage(`${message.player.name} åŠ å…¥äº†æˆ¿é—´`);
                    break;
                case 'player_left':
                    gameState.players = gameState.players.filter(p => p.id !== message.player_id);
                    updateWaitingPlayers();
                    showMessage(message.message);
                    break;
                case 'game_start':
                    startGame();
                    break;
                case 'game_action':
                    handleGameAction(message);
                    break;
                case 'state_update':
                    handleStateUpdate(message.state);
                    break;
            }
        }

        async function createRoom() {
            try {
                const result = await apiRequest('POST', '/api/rooms/create', {
                    player_name: gameState.playerName
                });

                gameState.roomId = result.room_id;
                gameState.playerId = result.player_id;
                gameState.isHost = true;
                gameState.players = [{
                    id: result.player_id,
                    name: result.player_name,
                    chips: 1000,
                    cards: [],
                    folded: false
                }];

                showWaitingRoom();
            } catch (error) {
                showMessage('åˆ›å»ºæˆ¿é—´å¤±è´¥: ' + error.message);
            }
        }

        async function joinRoom() {
            const roomId = document.getElementById('room-id-input').value.trim();

            if (!roomId) {
                showMessage('è¯·è¾“å…¥æˆ¿é—´ID');
                return;
            }

            try {
                const result = await apiRequest('POST', '/api/rooms/join', {
                    player_name: gameState.playerName,
                    room_id: roomId
                });

                gameState.roomId = result.room_id;
                gameState.playerId = result.player_id;
                gameState.isHost = false;
                gameState.players = result.players;

                showWaitingRoom();
            } catch (error) {
                showMessage('åŠ å…¥æˆ¿é—´å¤±è´¥: ' + error.message);
            }
        }

        function showWaitingRoom() {
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('waiting-room').classList.add('active');

            document.getElementById('display-room-id').textContent = gameState.roomId;
            document.getElementById('display-player-id').textContent = gameState.playerId;

            gameState.ws = connectWebSocket(gameState.roomId, gameState.playerId);
            updateWaitingPlayers();

            if (gameState.isHost) {
                document.getElementById('start-game-btn').style.display = 'block';
            }
        }

        function updateWaitingPlayers() {
            const listDiv = document.getElementById('waiting-players-list');
            listDiv.innerHTML = '';

            gameState.players.forEach(player => {
                const item = document.createElement('div');
                item.className = 'waiting-player';
                item.innerHTML = `
                    <div class="name">${player.name}</div>
                    <div style="color: #D4AF37; font-size: 0.9em;">${player.chips} ç­¹ç </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function startGame() {
            document.getElementById('waiting-room').classList.remove('active');
            document.getElementById('game-area').classList.add('active');
            document.getElementById('controls-area').style.display = 'flex';
            document.getElementById('mode-display').textContent = 'æ¨¡å¼: ğŸ‘¥ å¤šäººè”æœº';
            document.getElementById('room-id').textContent = gameState.roomId;

            if (gameState.isHost && gameState.ws) {
                gameState.ws.send(JSON.stringify({ type: 'game_start' }));
            }

            initGame();
        }

        function handleGameAction(message) {
            showMessage(`${message.player_id} æ‰§è¡Œäº† ${message.action}`);
        }

        function handleStateUpdate(state) {
            Object.assign(gameState, state);
            updateDisplay();
        }

        // ==================== æ¸¸æˆé€»è¾‘ ====================
        function initGame() {
            gameState.phase = 'preflop';
            gameState.pot = 0;
            gameState.communityCards = [];
            gameState.currentBet = 0;
            gameState.currentPlayerIndex = (gameState.dealerIndex + 3) % gameState.players.length;

            // é‡ç½®ç©å®¶çŠ¶æ€
            gameState.players.forEach(p => {
                p.cards = [];
                p.folded = false;
                p.bet = 0;
            });

            showMessage('æ–°çš„ä¸€å±€å¼€å§‹ï¼å‘ç‰Œä¸­...');
            createPlayerSeats();

            setTimeout(() => dealCards(), 1000);
        }

        function createDeck() {
            const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const deck = [];

            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({ suit, rank, value: RANK_VALUES[rank] });
                }
            }

            // æ´—ç‰Œ
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }

            return deck;
        }

        function dealCards() {
            gameState.deck = createDeck();

            // ç»™æ¯ä¸ªç©å®¶å‘ä¸¤å¼ ç‰Œ
            gameState.players.forEach(player => {
                player.cards = [gameState.deck.pop(), gameState.deck.pop()];
            });

            // æ”¶å–ç›²æ³¨
            const sbIndex = (gameState.dealerIndex + 1) % gameState.players.length;
            const bbIndex = (gameState.dealerIndex + 2) % gameState.players.length;

            gameState.players[sbIndex].chips -= gameState.smallBlind;
            gameState.players[sbIndex].bet = gameState.smallBlind;
            gameState.players[bbIndex].chips -= gameState.bigBlind;
            gameState.players[bbIndex].bet = gameState.bigBlind;
            gameState.pot = gameState.smallBlind + gameState.bigBlind;
            gameState.currentBet = gameState.bigBlind;

            updateDisplay();
            showMessage('å‘ç‰Œå®Œæˆï¼åº•æ³¨å·²æ”¶å–');

            updateControls();

            // å¦‚æœå½“å‰ç©å®¶æ˜¯AIï¼Œè®©AIè¡ŒåŠ¨
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            if (currentPlayer.isAI && !currentPlayer.folded) {
                setTimeout(() => aiAction(gameState.currentPlayerIndex), 1000);
            }
        }

        function createPlayerSeats() {
            const container = document.getElementById('player-seats');
            container.innerHTML = '';

            const count = gameState.players.length;

            gameState.players.forEach((player, index) => {
                const pos = seatPositions[index % seatPositions.length];

                const seat = document.createElement('div');
                seat.className = 'player-seat';
                seat.id = `player-seat-${index}`;
                seat.style.left = `calc(${pos.x}% - 80px)`;
                seat.style.top = `calc(${pos.y}% - 50px)`;

                const badges = [];
                if (index === gameState.dealerIndex) badges.push('<span class="status-badge dealer">D</span>');
                if (index === (gameState.dealerIndex + 1) % count) badges.push('<span class="status-badge small-blind">SB</span>');
                if (index === (gameState.dealerIndex + 2) % count) badges.push('<span class="status-badge big-blind">BB</span>');

                seat.innerHTML = `
                    <div class="seat-number">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                        <div class="player-details">
                            <div class="player-name">${player.name}${player.isAI ? ' ğŸ¤–' : ''}</div>
                            <div class="player-chips">${player.chips} ç­¹ç </div>
                        </div>
                    </div>
                    <div class="player-status">${badges.join('')}</div>
                    <div class="player-cards" id="player-cards-${index}"></div>
                    <div class="player-bet" id="player-bet-${index}"></div>
                `;

                container.appendChild(seat);
            });
        }

        function updateDisplay() {
            // æ›´æ–°å…¬å…±ç‰Œ
            const communityDiv = document.getElementById('community-cards');
            communityDiv.innerHTML = '';

            for (let i = 0; i < 5; i++) {
                if (i < gameState.communityCards.length) {
                    const card = gameState.communityCards[i];
                    communityDiv.innerHTML += createCardHTML(card);
                } else {
                    communityDiv.innerHTML += '<div class="card card-back"></div>';
                }
            }

            // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
            gameState.players.forEach((player, index) => {
                const cardsDiv = document.getElementById(`player-cards-${index}`);
                const betDiv = document.getElementById(`player-bet-${index}`);
                if (!cardsDiv) return;

                cardsDiv.innerHTML = '';
                if (player.cards && player.cards.length > 0) {
                    // æ˜¾ç¤ºæ‰‹ç‰Œï¼ˆAIçš„ç‰Œåªåœ¨æ‘Šç‰Œæ—¶æ˜¾ç¤ºï¼‰
                    const showCards = !player.isAI || gameState.phase === 'showdown';
                    player.cards.forEach(card => {
                        if (showCards) {
                            cardsDiv.innerHTML += createCardHTML(card, true);
                        } else {
                            cardsDiv.innerHTML += '<div class="card card-back" style="width:40px;height:56px;"></div>';
                        }
                    });
                }

                if (betDiv) {
                    betDiv.textContent = player.bet > 0 ? `ä¸‹æ³¨: ${player.bet}` : '';
                }

                // æ›´æ–°åº§ä½çŠ¶æ€
                const seat = document.getElementById(`player-seat-${index}`);
                if (seat) {
                    seat.classList.toggle('folded', player.folded);
                    seat.classList.toggle('active', index === gameState.currentPlayerIndex && !player.folded);

                    // æ›´æ–°ç­¹ç æ˜¾ç¤º
                    const chipsEl = seat.querySelector('.player-chips');
                    if (chipsEl) chipsEl.textContent = `${player.chips} ç­¹ç `;
                }
            });

            // æ›´æ–°åº•æ± 
            document.getElementById('pot').textContent = gameState.pot;
        }

        function createCardHTML(card, small = false) {
            const isRed = card.suit === 'â™¥' || card.suit === 'â™¦';
            return `<div class="card ${isRed ? 'red' : 'black'}" ${small ? 'style="width:40px;height:56px;font-size:14px;"' : ''}>
                <span class="card-rank">${card.rank}</span>
                <span class="card-suit">${card.suit}</span>
            </div>`;
        }

        function updateControls() {
            const player = gameState.players[0];
            const isPlayerTurn = gameState.currentPlayerIndex === 0 && !player.folded;
            const callAmount = gameState.currentBet - player.bet;

            document.getElementById('btn-fold').disabled = !isPlayerTurn;
            document.getElementById('btn-check').disabled = !isPlayerTurn || callAmount > 0;
            document.getElementById('btn-call').disabled = !isPlayerTurn || callAmount <= 0;
            document.getElementById('btn-call').textContent = callAmount > 0 ? `è·Ÿæ³¨ ${callAmount}` : 'è·Ÿæ³¨';
            document.getElementById('btn-raise').disabled = !isPlayerTurn;
            document.getElementById('btn-allin').disabled = !isPlayerTurn;
        }

        function playerAction(action) {
            if (gameMode === 'multiplayer' && gameState.ws) {
                // å¤šäººæ¨¡å¼ - å‘é€åˆ°æœåŠ¡å™¨
                gameState.ws.send(JSON.stringify({ type: 'game_action', action }));
            } else {
                // äººæœºæ¨¡å¼ - æœ¬åœ°å¤„ç†
                executeAction(0, action);
            }
        }

        function executeAction(playerIndex, action) {
            const player = gameState.players[playerIndex];
            if (player.folded) return;

            const callAmount = gameState.currentBet - player.bet;

            switch (action) {
                case 'fold':
                    player.folded = true;
                    showMessage(`${player.name} å¼ƒç‰Œ`);
                    break;
                case 'check':
                    showMessage(`${player.name} è¿‡ç‰Œ`);
                    break;
                case 'call':
                    const actualCall = Math.min(callAmount, player.chips);
                    player.chips -= actualCall;
                    player.bet += actualCall;
                    gameState.pot += actualCall;
                    showMessage(`${player.name} è·Ÿæ³¨ ${actualCall}`);
                    break;
                case 'raise':
                    const raiseAmount = gameState.bigBlind;
                    const totalBet = callAmount + raiseAmount;
                    const actualRaise = Math.min(totalBet, player.chips);
                    player.chips -= actualRaise;
                    player.bet += actualRaise;
                    gameState.pot += actualRaise;
                    gameState.currentBet = player.bet;
                    showMessage(`${player.name} åŠ æ³¨åˆ° ${player.bet}`);
                    break;
                case 'allin':
                    const allInAmount = player.chips;
                    player.bet += allInAmount;
                    gameState.pot += allInAmount;
                    player.chips = 0;
                    if (player.bet > gameState.currentBet) {
                        gameState.currentBet = player.bet;
                    }
                    showMessage(`${player.name} å…¨æŠ¼ï¼`);
                    break;
            }

            updateDisplay();

            // ä¸‹ä¸€ä¸ªç©å®¶
            nextPlayer();
        }

        function nextPlayer() {
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç©å®¶éƒ½è¡ŒåŠ¨è¿‡
            const activePlayers = gameState.players.filter(p => !p.folded);

            if (activePlayers.length === 1) {
                // åªå‰©ä¸€ä¸ªç©å®¶ï¼Œç›´æ¥è·èƒœ
                endRound(activePlayers[0]);
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æœªå¼ƒç‰Œç©å®¶çš„ä¸‹æ³¨ç›¸ç­‰
            const allMatched = activePlayers.every(p => p.bet === gameState.currentBet || p.chips === 0);

            if (allMatched) {
                // è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                nextPhase();
                return;
            }

            // æ‰¾ä¸‹ä¸€ä¸ªæœªå¼ƒç‰Œçš„ç©å®¶
            do {
                gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            } while (gameState.players[gameState.currentPlayerIndex].folded);

            updateDisplay();
            updateControls();

            // å¦‚æœæ˜¯AIï¼Œå»¶è¿Ÿåè¡ŒåŠ¨
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            if (currentPlayer.isAI && !currentPlayer.folded) {
                setTimeout(() => aiAction(gameState.currentPlayerIndex), 1000 + Math.random() * 1000);
            }
        }

        function nextPhase() {
            // é‡ç½®ä¸‹æ³¨
            gameState.players.forEach(p => p.bet = 0);
            gameState.currentBet = 0;

            switch (gameState.phase) {
                case 'preflop':
                    gameState.phase = 'flop';
                    gameState.communityCards.push(gameState.deck.pop(), gameState.deck.pop(), gameState.deck.pop());
                    showMessage('ç¿»ç‰Œåœˆï¼');
                    break;
                case 'flop':
                    gameState.phase = 'turn';
                    gameState.communityCards.push(gameState.deck.pop());
                    showMessage('è½¬ç‰Œåœˆï¼');
                    break;
                case 'turn':
                    gameState.phase = 'river';
                    gameState.communityCards.push(gameState.deck.pop());
                    showMessage('æ²³ç‰Œåœˆï¼');
                    break;
                case 'river':
                    gameState.phase = 'showdown';
                    showdown();
                    return;
            }

            // ä»åº„å®¶åä¸€ä½å¼€å§‹
            gameState.currentPlayerIndex = (gameState.dealerIndex + 1) % gameState.players.length;
            while (gameState.players[gameState.currentPlayerIndex].folded) {
                gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            }

            updateDisplay();
            updateControls();

            // å¦‚æœæ˜¯AIå…ˆæ‰‹
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            if (currentPlayer.isAI && !currentPlayer.folded) {
                setTimeout(() => aiAction(gameState.currentPlayerIndex), 1000);
            }
        }

        // ==================== AI é€»è¾‘ ====================
        function aiAction(playerIndex) {
            const player = gameState.players[playerIndex];
            const callAmount = gameState.currentBet - player.bet;

            // ç®€å•AIç­–ç•¥
            const handStrength = evaluateHandStrength(player);
            const random = Math.random();

            let action;

            if (handStrength > 0.7) {
                // å¼ºç‰Œ - åŠ æ³¨æˆ–è·Ÿæ³¨
                action = random > 0.3 ? 'raise' : 'call';
            } else if (handStrength > 0.4) {
                // ä¸­ç­‰ç‰Œ - è·Ÿæ³¨æˆ–è¿‡ç‰Œ
                action = callAmount > 0 ? 'call' : 'check';
            } else if (handStrength > 0.2) {
                // å¼±ç‰Œ - è·Ÿæ³¨æˆ–å¼ƒç‰Œ
                action = callAmount > 0 ? (random > 0.5 ? 'call' : 'fold') : 'check';
            } else {
                // å¾ˆå¼±çš„ç‰Œ
                action = callAmount === 0 ? 'check' : (random > 0.7 ? 'call' : 'fold');
            }

            // ç¡®ä¿è¡ŒåŠ¨åˆæ³•
            if (action === 'check' && callAmount > 0) action = 'fold';
            if (action === 'raise' && player.chips <= callAmount) action = 'call';

            executeAction(playerIndex, action);
        }

        function evaluateHandStrength(player) {
            if (!player.cards || player.cards.length === 0) return 0.5;

            // ç®€å•çš„ç‰ŒåŠ›è¯„ä¼°
            const card1 = player.cards[0];
            const card2 = player.cards[1];

            let strength = 0;

            // é«˜ç‰ŒåŠ åˆ†
            strength += (card1.value + card2.value) / 28;

            // å¯¹å­åŠ åˆ†
            if (card1.rank === card2.rank) {
                strength += 0.3;
                if (card1.value >= 10) strength += 0.2;
            }

            // åŒèŠ±åŠ åˆ†
            if (card1.suit === card2.suit) strength += 0.1;

            // è¿å¼ åŠ åˆ†
            if (Math.abs(card1.value - card2.value) === 1) strength += 0.1;
            if (card1.value === 14 && card2.value === 2) strength += 0.05; // A2

            // ç»“åˆå…¬å…±ç‰Œè¯„ä¼°
            if (gameState.communityCards.length > 0) {
                const allCards = [...player.cards, ...gameState.communityCards];
                const eval = evaluateHand(allCards);
                strength += eval.rank / 10;
            }

            return Math.min(strength, 1);
        }

        // ==================== æ‘Šç‰Œ ====================
        function showdown() {
            showMessage('æ‘Šç‰Œï¼');

            const activePlayers = gameState.players.filter(p => !p.folded);
            let bestPlayer = null;
            let bestRank = -1;

            activePlayers.forEach(player => {
                const allCards = [...player.cards, ...gameState.communityCards];
                const eval = evaluateHand(allCards);

                if (eval.rank > bestRank) {
                    bestRank = eval.rank;
                    bestPlayer = player;
                }
            });

            setTimeout(() => endRound(bestPlayer), 2000);
        }

        function endRound(winner) {
            winner.chips += gameState.pot;

            const panel = document.getElementById('game-over-panel');
            document.getElementById('game-over-title').textContent = 'æœ¬å±€ç»“æŸ';
            document.getElementById('game-over-message').textContent = `${winner.name} èµ¢å¾—äº† ${gameState.pot} ç­¹ç ï¼`;
            panel.classList.add('active');

            // æ ‡è®°è·èƒœè€…
            const winnerIndex = gameState.players.indexOf(winner);
            const seat = document.getElementById(`player-seat-${winnerIndex}`);
            if (seat) seat.classList.add('winner');

            // ç§»åŠ¨åº„å®¶ä½ç½®
            gameState.dealerIndex = (gameState.dealerIndex + 1) % gameState.players.length;
            gameState.roundNumber++;
            document.getElementById('round-info').textContent = gameState.roundNumber;
        }

        function startNewGame() {
            document.getElementById('game-over-panel').classList.remove('active');

            // ç§»é™¤è·èƒœè€…æ ‡è®°
            document.querySelectorAll('.player-seat').forEach(seat => {
                seat.classList.remove('winner');
            });

            initGame();
        }

        function backToLobby() {
            location.reload();
        }

        // ==================== ç‰Œå‹è¯„ä¼° ====================
        function evaluateHand(cards) {
            const values = cards.map(c => c.value).sort((a, b) => b - a);
            const suits = cards.map(c => c.suit);
            const valueCounts = {};
            values.forEach(v => valueCounts[v] = (valueCounts[v] || 0) + 1);
            const counts = Object.values(valueCounts).sort((a, b) => b - a);
            const uniqueValues = [...new Set(values)].sort((a, b) => b - a);

            const isFlush = suits.every(s => s === suits[0]) ||
                           cards.filter(c => c.suit === suits[0]).length >= 5;
            const isStraight = checkStraight(uniqueValues);

            if (isFlush && isStraight) return { rank: 9, name: 'åŒèŠ±é¡º' };
            if (counts[0] === 4) return { rank: 8, name: 'å››æ¡' };
            if (counts[0] === 3 && counts[1] === 2) return { rank: 7, name: 'è‘«èŠ¦' };
            if (isFlush) return { rank: 6, name: 'åŒèŠ±' };
            if (isStraight) return { rank: 5, name: 'é¡ºå­' };
            if (counts[0] === 3) return { rank: 4, name: 'ä¸‰æ¡' };
            if (counts[0] === 2 && counts[1] === 2) return { rank: 3, name: 'ä¸¤å¯¹' };
            if (counts[0] === 2) return { rank: 2, name: 'ä¸€å¯¹' };
            return { rank: 1, name: 'é«˜ç‰Œ' };
        }

        function checkStraight(values) {
            if (values.length < 5) return false;
            for (let i = 0; i <= values.length - 5; i++) {
                if (values[i] - values[i + 4] === 4) return true;
            }
            // A2345
            if (values.includes(14) && values.includes(2) && values.includes(3) &&
                values.includes(4) && values.includes(5)) return true;
            return false;
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function showMessage(msg) {
            document.getElementById('message').innerHTML = msg;
        }

        function exitGame() {
            if (confirm('ç¡®å®šè¦é€€å‡ºæ¸¸æˆå—ï¼Ÿ')) {
                if (gameState.ws) {
                    gameState.ws.close();
                }
                location.reload();
            }
        }

        function updateConnectionStatus(connected) {
            const statusEls = [
                document.getElementById('connection-status'),
                document.getElementById('lobby-status')
            ];

            statusEls.forEach(el => {
                if (!el) return;
                if (connected) {
                    el.className = 'connection-status connected';
                    el.textContent = 'âœ… å·²è¿æ¥';
                } else {
                    el.className = 'connection-status disconnected';
                    el.textContent = 'âŒ æœªè¿æ¥';
                }
            });
        }

        async function checkBackend() {
            try {
                await apiRequest('GET', '/');
                updateConnectionStatus(true);
            } catch (error) {
                updateConnectionStatus(false);
            }
        }
    </script>
</body>
</html>
